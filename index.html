<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">
<title>NutriLearn Academy: Curso Interactivo & IA</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap');
body { 
font-family: 'Plus Jakarta Sans', sans-serif; 
background-color: #faf9f6;
color: #334155; 
}
.chart-container {
position: relative;
width: 100%;
max-width: 600px;
height: 300px;
max-height: 400px;
margin-left: auto;
margin-right: auto;
}
@media (min-width: 768px) {
.chart-container {
height: 350px;
}
}
.glass-panel {
background: rgba(255, 255, 255, 0.9);
backdrop-filter: blur(12px);
border: 1px solid rgba(255, 255, 255, 0.5);
box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
}
.nav-link {
position: relative;
transition: all 0.3s ease;
}
.nav-link.active {
color: #059669;
background-color: #ecfdf5;
}
.nav-link.active::after {
content: '';
position: absolute;
right: 0;
top: 50%;
transform: translateY(-50%);
height: 20px;
width: 4px;
background-color: #059669;
border-radius: 4px 0 0 4px;
}
.loader {
display: inline-block;
width: 20px;
height: 20px;
border: 3px solid rgba(16, 185, 129, 0.3);
border-radius: 50%;
border-top-color: #059669;
animation: spin 1s ease-in-out infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
.fade-in { animation: fadeIn 0.4s ease-out forwards; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.chat-scroll::-webkit-scrollbar { width: 6px; }
.chat-scroll::-webkit-scrollbar-track { background: #f1f5f9; }
.chat-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
.chat-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
</style>
</head>
<body class="flex h-screen overflow-hidden">
<aside class="hidden md:flex flex-col w-64 bg-white border-r border-slate-200 h-full z-10">
<div class="p-6 flex items-center gap-3">
<span class="text-3xl">ü•ë</span>
<div>
<h1 class="font-bold text-slate-800 text-lg leading-tight">NutriLearn</h1>
<p class="text-xs text-emerald-600 font-semibold tracking-wider">ACADEMY AI</p>
</div>
</div>
<nav class="flex-1 px-4 space-y-2 mt-4">
<button onclick="app.navigate('dashboard')" class="nav-link w-full flex items-center gap-3 px-4 py-3 text-slate-600 rounded-xl hover:bg-slate-50 font-medium transition-colors" data-view="dashboard">
<span>üìä</span> Dashboard
</button>
<button onclick="app.navigate('macros')" class="nav-link w-full flex items-center gap-3 px-4 py-3 text-slate-600 rounded-xl hover:bg-slate-50 font-medium transition-colors" data-view="macros">
<span>üß¨</span> Bio-Qu√≠mica
</button>
<button onclick="app.navigate('energy')" class="nav-link w-full flex items-center gap-3 px-4 py-3 text-slate-600 rounded-xl hover:bg-slate-50 font-medium transition-colors" data-view="energy">
<span>‚ö°</span> Lab de Energ√≠a
</button>
<button onclick="app.navigate('ai-suite')" class="nav-link w-full flex items-center gap-3 px-4 py-3 text-slate-600 rounded-xl hover:bg-slate-50 font-medium transition-colors" data-view="ai-suite">
<span>ü§ñ</span> Asistente IA
</button>
</nav>
<div class="p-6 border-t border-slate-100">
<div class="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl p-4 text-white shadow-lg">
<p class="text-xs font-medium opacity-90 mb-1">Estado de API</p>
<div class="flex items-center gap-2">
<div class="w-2 h-2 bg-white rounded-full animate-pulse"></div>
<span class="text-sm font-bold">Gemini 2.5 Activo</span>
</div>
</div>
</div>
</aside>
<main class="flex-1 h-full overflow-y-auto relative bg-[#faf9f6]">
<div class="md:hidden bg-white p-4 flex justify-between items-center border-b sticky top-0 z-20">
<span class="font-bold text-lg text-slate-800">ü•ë NutriLearn AI</span>
<button onclick="document.getElementById('mobile-menu').classList.toggle('hidden')" class="text-slate-600">‚ò∞</button>
</div>
<div id="mobile-menu" class="hidden md:hidden absolute top-16 left-0 w-full bg-white border-b shadow-xl z-20 flex flex-col p-4 space-y-2">
<button onclick="app.navigate('dashboard')" class="p-3 text-left font-medium text-slate-700 bg-slate-50 rounded-lg">Dashboard</button>
<button onclick="app.navigate('macros')" class="p-3 text-left font-medium text-slate-700 bg-slate-50 rounded-lg">Bio-Qu√≠mica</button>
<button onclick="app.navigate('energy')" class="p-3 text-left font-medium text-slate-700 bg-slate-50 rounded-lg">Lab de Energ√≠a</button>
<button onclick="app.navigate('ai-suite')" class="p-3 text-left font-medium text-slate-700 bg-slate-50 rounded-lg">Asistente IA</button>
</div>
<section id="view-dashboard" class="p-6 md:p-10 max-w-6xl mx-auto fade-in">
<div class="mb-8">
<h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4">Bienvenido a tu Evoluci√≥n Nutricional</h2>
<p class="text-lg text-slate-600 max-w-3xl leading-relaxed">
La nutrici√≥n es la ciencia de c√≥mo los alimentos nutren tu cuerpo. Esta plataforma interactiva combina datos visuales con inteligencia artificial para que pases de la teor√≠a a la pr√°ctica. Empieza explorando tus m√©tricas b√°sicas o consulta a la IA.
</p>
</div>
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
<div class="glass-panel p-6 rounded-2xl border-t-4 border-emerald-500 hover:-translate-y-1 transition-transform cursor-pointer" onclick="app.navigate('macros')">
<div class="flex justify-between items-start mb-4">
<div class="p-3 bg-emerald-100 rounded-xl text-2xl">üß¨</div>
<span class="text-xs font-bold bg-slate-100 text-slate-500 px-2 py-1 rounded">Teor√≠a</span>
</div>
<h3 class="text-xl font-bold text-slate-800 mb-2">Macronutrientes</h3>
<p class="text-sm text-slate-500">Aprende la diferencia entre combustible (carbos), estructura (prote√≠na) y reserva (grasas).</p>
</div>
<div class="glass-panel p-6 rounded-2xl border-t-4 border-amber-500 hover:-translate-y-1 transition-transform cursor-pointer" onclick="app.navigate('energy')">
<div class="flex justify-between items-start mb-4">
<div class="p-3 bg-amber-100 rounded-xl text-2xl">‚ö°</div>
<span class="text-xs font-bold bg-slate-100 text-slate-500 px-2 py-1 rounded">C√°lculo</span>
</div>
<h3 class="text-xl font-bold text-slate-800 mb-2">Balance Energ√©tico</h3>
<p class="text-sm text-slate-500">Calcula tu TDEE (Gasto Energ√©tico Total Diario) y personaliza tus objetivos.</p>
</div>
<div class="glass-panel p-6 rounded-2xl border-t-4 border-indigo-500 hover:-translate-y-1 transition-transform cursor-pointer" onclick="app.navigate('ai-suite')">
<div class="flex justify-between items-start mb-4">
<div class="p-3 bg-indigo-100 rounded-xl text-2xl">ü§ñ</div>
<span class="text-xs font-bold bg-indigo-100 text-indigo-600 px-2 py-1 rounded">Interactivo</span>
</div>
<h3 class="text-xl font-bold text-slate-800 mb-2">Consultor IA</h3>
<p class="text-sm text-slate-500">Analiza fotos de platos (descripci√≥n) o pide men√∫s personalizados al instante.</p>
</div>
</div>
<div class="glass-panel p-8 rounded-3xl">
<div class="flex flex-col md:flex-row items-center gap-8">
<div class="flex-1">
<h3 class="text-2xl font-bold text-slate-800 mb-4">El Plato Saludable Ideal</h3>
<p class="text-slate-600 mb-6">
M√°s all√° de contar calor√≠as, la proporci√≥n visual es clave. La ciencia moderna sugiere que la mitad de tu ingesta debe provenir de vegetales y frutas para garantizar el aporte de micronutrientes y fibra.
</p>
<ul class="space-y-3">
<li class="flex items-center gap-3 text-sm text-slate-700">
<span class="w-3 h-3 rounded-full bg-emerald-500"></span> 50% Vegetales y Frutas (Volumen y Fibra)
</li>
<li class="flex items-center gap-3 text-sm text-slate-700">
<span class="w-3 h-3 rounded-full bg-amber-500"></span> 25% Granos Integrales (Energ√≠a Sostenida)
</li>
<li class="flex items-center gap-3 text-sm text-slate-700">
<span class="w-3 h-3 rounded-full bg-red-500"></span> 25% Prote√≠na Magra (Reparaci√≥n)
</li>
</ul>
</div>
<div class="flex-1 w-full">
<div class="chart-container">
<canvas id="plateChart"></canvas>
</div>
</div>
</div>
</div>
</section>
<section id="view-macros" class="p-6 md:p-10 max-w-6xl mx-auto hidden fade-in">
<div class="mb-10">
<span class="text-emerald-600 font-bold tracking-wider text-sm uppercase">M√≥dulo 1</span>
<h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4">La Qu√≠mica de los Alimentos</h2>
<p class="text-lg text-slate-600 leading-relaxed">
No todas las calor√≠as son iguales. Entender la densidad cal√≥rica y la funci√≥n metab√≥lica de cada macronutriente es esencial para tomar decisiones informadas. Aqu√≠ visualizamos c√≥mo se compara la energ√≠a que aporta cada gramo.
</p>
</div>
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
<div class="glass-panel p-6 rounded-2xl">
<div class="mb-6">
<h3 class="text-xl font-bold text-slate-800">Densidad Cal√≥rica (kcal/gramo)</h3>
<p class="text-sm text-slate-500">Observa c√≥mo las grasas contienen m√°s del doble de energ√≠a por gramo que las prote√≠nas o carbohidratos.</p>
</div>
<div class="chart-container">
<canvas id="densityChart"></canvas>
</div>
</div>
<div class="glass-panel p-6 rounded-2xl flex flex-col">
<div class="mb-6">
<h3 class="text-xl font-bold text-slate-800">Distribuci√≥n de Macronutrientes</h3>
<p class="text-sm text-slate-500 mb-4">Selecciona un perfil para ver c√≥mo cambia la recomendaci√≥n de ingesta.</p>
<div class="flex gap-2 p-1 bg-slate-100 rounded-lg inline-flex">
<button onclick="app.updateDistribution('standard')" class="px-4 py-2 text-sm rounded-md font-medium transition-all bg-white shadow-sm text-slate-800" id="btn-standard">Est√°ndar</button>
<button onclick="app.updateDistribution('athlete')" class="px-4 py-2 text-sm rounded-md font-medium transition-all text-slate-500 hover:text-slate-700" id="btn-athlete">Atleta</button>
<button onclick="app.updateDistribution('keto')" class="px-4 py-2 text-sm rounded-md font-medium transition-all text-slate-500 hover:text-slate-700" id="btn-keto">Low Carb</button>
</div>
</div>
<div class="chart-container flex-grow">
<canvas id="distributionChart"></canvas>
</div>
<div id="dist-text" class="mt-4 p-4 bg-emerald-50 rounded-xl text-sm text-emerald-800 border border-emerald-100">
Equilibrio recomendado para la poblaci√≥n general, priorizando salud a largo plazo.
</div>
</div>
</div>
</section>
<section id="view-energy" class="p-6 md:p-10 max-w-6xl mx-auto hidden fade-in">
<div class="mb-10">
<span class="text-amber-500 font-bold tracking-wider text-sm uppercase">M√≥dulo 2</span>
<h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4">Laboratorio de Energ√≠a</h2>
<p class="text-lg text-slate-600 leading-relaxed">
Tu cuerpo es un motor biol√≥gico. Utiliza esta herramienta para estimar tu Tasa Metab√≥lica Basal (lo que quemas en reposo) y tu Gasto Total Diario (TDEE). Estos n√∫meros son el punto de partida para cualquier plan nutricional.
</p>
</div>
<div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
<div class="lg:col-span-5 glass-panel p-8 rounded-3xl h-fit">
<h3 class="font-bold text-xl text-slate-800 mb-6">Tus Par√°metros</h3>
<div class="space-y-5">
<div class="grid grid-cols-2 gap-4">
<div>
<label class="block text-xs font-bold text-slate-500 uppercase mb-2">G√©nero</label>
<select id="calc-gender" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-amber-400 outline-none">
<option value="male">Hombre</option>
<option value="female">Mujer</option>
</select>
</div>
<div>
<label class="block text-xs font-bold text-slate-500 uppercase mb-2">Edad</label>
<input type="number" id="calc-age" value="30" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-amber-400 outline-none">
</div>
</div>
<div class="grid grid-cols-2 gap-4">
<div>
<label class="block text-xs font-bold text-slate-500 uppercase mb-2">Peso (kg)</label>
<input type="number" id="calc-weight" value="70" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-amber-400 outline-none">
</div>
<div>
<label class="block text-xs font-bold text-slate-500 uppercase mb-2">Altura (cm)</label>
<input type="number" id="calc-height" value="175" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-amber-400 outline-none">
</div>
</div>
<div>
<label class="block text-xs font-bold text-slate-500 uppercase mb-2">Actividad F√≠sica</label>
<select id="calc-activity" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-amber-400 outline-none">
<option value="1.2">Sedentario (Oficina, poco movimiento)</option>
<option value="1.375">Ligera (Ejercicio 1-3 d√≠as/sem)</option>
<option value="1.55">Moderada (Ejercicio 3-5 d√≠as/sem)</option>
<option value="1.725">Intensa (Ejercicio 6-7 d√≠as/sem)</option>
</select>
</div>
<button onclick="app.calculateTDEE()" class="w-full py-4 bg-amber-500 hover:bg-amber-600 text-white font-bold rounded-xl shadow-lg shadow-amber-200 transition-all transform active:scale-95">
Calcular Requerimientos
</button>
</div>
</div>
<div class="lg:col-span-7 space-y-6">
<div class="bg-slate-900 text-white p-8 rounded-3xl shadow-xl relative overflow-hidden">
<div class="absolute right-0 top-0 opacity-10 text-9xl transform translate-x-10 -translate-y-10">‚ö°</div>
<div class="relative z-10">
<p class="text-slate-400 font-bold uppercase tracking-widest text-xs mb-2">Gasto Energ√©tico Diario (TDEE)</p>
<div class="flex items-baseline gap-2">
<span id="result-tdee" class="text-6xl font-extrabold text-amber-400">0</span>
<span class="text-xl text-slate-400">kcal/d√≠a</span>
</div>
<p class="mt-4 text-slate-300 max-w-md">Estas son las calor√≠as que necesitas para mantener tu peso actual considerando tu actividad.</p>
</div>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div class="glass-panel p-6 rounded-2xl border-l-4 border-emerald-500">
<h4 class="font-bold text-slate-700 mb-1">D√©ficit (P√©rdida de Grasa)</h4>
<p class="text-3xl font-bold text-emerald-600" id="result-cut">0 <span class="text-sm font-normal text-slate-500">kcal</span></p>
<p class="text-xs text-slate-400 mt-2">D√©ficit sostenible del 20%</p>
</div>
<div class="glass-panel p-6 rounded-2xl border-l-4 border-blue-500">
<h4 class="font-bold text-slate-700 mb-1">Super√°vit (Ganancia Muscular)</h4>
<p class="text-3xl font-bold text-blue-600" id="result-bulk">0 <span class="text-sm font-normal text-slate-500">kcal</span></p>
<p class="text-xs text-slate-400 mt-2">Excedente controlado del 10%</p>
</div>
</div>
</div>
</div>
</section>
<section id="view-ai-suite" class="p-6 md:p-10 max-w-6xl mx-auto hidden fade-in">
<div class="mb-10 flex flex-col md:flex-row md:items-center justify-between gap-4">
<div>
<span class="text-indigo-500 font-bold tracking-wider text-sm uppercase">M√≥dulo 3</span>
<h2 class="text-3xl md:text-4xl font-bold text-slate-900">Asistente Nutricional IA</h2>
</div>
<div class="flex items-center gap-2 px-4 py-2 bg-indigo-50 text-indigo-700 rounded-full text-sm font-bold">
<span>‚ú® Powered by Gemini 2.5 Flash</span>
</div>
</div>
<p class="text-lg text-slate-600 leading-relaxed mb-8">
Aplica lo aprendido. Usa la Inteligencia Artificial para analizar comidas reales, resolver dudas complejas o generar planes de alimentaci√≥n adaptados a tus c√°lculos del m√≥dulo anterior.
</p>
<div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
<div class="lg:col-span-4 space-y-6">
<div class="glass-panel p-6 rounded-3xl border border-indigo-100">
<h3 class="font-bold text-lg text-slate-800 mb-4 flex items-center gap-2">
<span>üì∏</span> Analizar Comida
</h3>
<textarea id="ai-food-input" placeholder="Ej: Dos tostadas con aguacate, un huevo revuelto y caf√© negro..." class="w-full h-32 p-4 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-400 outline-none resize-none text-sm transition-shadow"></textarea>
<button onclick="app.analyzeFood()" id="btn-analyze" class="w-full mt-4 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl transition-colors flex justify-center items-center gap-2">
<span>‚ú®</span> Analizar Nutrientes
</button>
</div>
<div class="glass-panel p-6 rounded-3xl border border-emerald-100">
<h3 class="font-bold text-lg text-slate-800 mb-4 flex items-center gap-2">
<span>üìÖ</span> Planificador R√°pido
</h3>
<div class="space-y-3">
<select id="ai-plan-goal" class="w-full p-3 bg-white border border-slate-200 rounded-xl text-sm outline-none">
<option value="p√©rdida de grasa">P√©rdida de Grasa</option>
<option value="ganancia muscular">Ganancia Muscular</option>
<option value="energ√≠a y vitalidad">Energ√≠a y Vitalidad</option>
</select>
<input type="text" id="ai-plan-cal" placeholder="Calor√≠as objetivo (Opcional)" class="w-full p-3 bg-white border border-slate-200 rounded-xl text-sm outline-none">
</div>
<button onclick="app.generatePlan()" id="btn-plan" class="w-full mt-4 py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-bold rounded-xl transition-colors flex justify-center items-center gap-2">
<span>‚ú®</span> Generar Men√∫
</button>
</div>
</div>
<div class="lg:col-span-8 flex flex-col h-[600px] glass-panel rounded-3xl overflow-hidden shadow-2xl border-0">
<div class="bg-slate-800 p-4 flex justify-between items-center">
<span class="text-slate-100 font-bold flex items-center gap-2"><span class="w-2 h-2 bg-emerald-400 rounded-full"></span> Tutor IA En L√≠nea</span>
<button onclick="app.clearChat()" class="text-xs text-slate-400 hover:text-white uppercase font-bold tracking-wider">Limpiar</button>
</div>
<div id="chat-container" class="flex-1 overflow-y-auto p-6 space-y-6 bg-slate-50 chat-scroll">
<div class="flex gap-4">
<div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-lg flex-shrink-0">ü§ñ</div>
<div class="bg-white p-4 rounded-2xl rounded-tl-none shadow-sm text-slate-700 text-sm border border-slate-100">
<p>¬°Hola! Soy tu asistente de nutrici√≥n. Puedo analizar los ingredientes de tus comidas, explicarte conceptos complejos o crear un plan de alimentaci√≥n basado en tus macros. ¬øPor d√≥nde empezamos?</p>
</div>
</div>
</div>
<div class="p-4 bg-white border-t border-slate-100">
<div class="relative flex items-center">
<input type="text" id="chat-input" placeholder="Haz una pregunta general (Ej: ¬øPor qu√© es importante la fibra?)..." class="w-full bg-slate-100 border-none rounded-2xl py-4 pl-5 pr-14 focus:ring-2 focus:ring-indigo-500 outline-none text-slate-700 placeholder-slate-400">
<button onclick="app.sendChat()" class="absolute right-2 p-2 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-transform active:scale-95">
‚û§
</button>
</div>
</div>
</div>
</div>
</section>
</main>
<script>
// üîí IMPORTANTE: Reemplaza 'TU_API_KEY_AQUI' con tu API Key real
// O mejor a√∫n: usa variables de entorno en Netlify
const apiKey = "TU_API_KEY_AQUI"; // ‚ö†Ô∏è Cambia esto por tu API Key real

const app = {
    state: {
        currentView: 'dashboard',
        tdee: 0,
        distribution: 'standard'
    },
    charts: {},
    
    init: function() {
        this.renderNav();
        this.setupCharts();
        document.getElementById('chat-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') this.sendChat();
        });
    },
    
    renderNav: function() {
        // Navegaci√≥n ya est√° implementada en los botones
    },
    
    navigate: function(viewId) {
        // Ocultar todas las vistas
        ['dashboard', 'macros', 'energy', 'ai-suite'].forEach(id => {
            const view = document.getElementById(`view-${id}`);
            view.classList.add('hidden');
            view.classList.remove('fade-in');
        });
        
        // Mostrar vista objetivo
        const target = document.getElementById(`view-${viewId}`);
        target.classList.remove('hidden');
        setTimeout(() => target.classList.add('fade-in'), 10);
        
        // Actualizar navegaci√≥n activa
        document.querySelectorAll('.nav-link').forEach(el => {
            if (el.dataset.view === viewId) {
                el.classList.add('active');
            } else {
                el.classList.remove('active');
            }
        });
        
        // Cerrar men√∫ m√≥vil si est√° abierto
        document.getElementById('mobile-menu').classList.add('hidden');
    },
    
    setupCharts: function() {
        // Gr√°fico del Plato
        const ctxPlate = document.getElementById('plateChart').getContext('2d');
        this.charts.plate = new Chart(ctxPlate, {
            type: 'pie',
            data: {
                labels: ['Vegetales/Frutas', 'Granos Integrales', 'Prote√≠na Magra'],
                datasets: [{
                    data: [50, 25, 25],
                    backgroundColor: ['#10b981', '#f59e0b', '#ef4444'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom' } }
            }
        });
        
        // Gr√°fico de Densidad
        const ctxDensity = document.getElementById('densityChart').getContext('2d');
        this.charts.density = new Chart(ctxDensity, {
            type: 'bar',
            data: {
                labels: ['Vegetales', 'Carbohidratos', 'Prote√≠nas', 'Alcohol', 'Grasas'],
                datasets: [{
                    label: 'Kcal por gramo',
                    data: [0.5, 4, 4, 7, 9],
                    backgroundColor: ['#10b981', '#3b82f6', '#ef4444', '#94a3b8', '#f59e0b'],
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true } }
            }
        });
        
        // Gr√°fico de Distribuci√≥n
        const ctxDist = document.getElementById('distributionChart').getContext('2d');
        this.charts.dist = new Chart(ctxDist, {
            type: 'doughnut',
            data: {
                labels: ['Carbohidratos', 'Prote√≠nas', 'Grasas'],
                datasets: [{
                    data: [50, 20, 30],
                    backgroundColor: ['#3b82f6', '#ef4444', '#f59e0b'],
                    borderWidth: 0,
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '75%',
                plugins: {
                    legend: { position: 'right' },
                    title: { display: true, text: 'Perfil Est√°ndar' }
                }
            }
        });
    },
    
    updateDistribution: function(profile) {
        // Actualizar botones
        ['standard', 'athlete', 'keto'].forEach(id => {
            const btn = document.getElementById(`btn-${id}`);
            btn.className = (id === profile)
                ? "px-4 py-2 text-sm rounded-md font-medium transition-all bg-white shadow-sm text-slate-800 border border-slate-200"
                : "px-4 py-2 text-sm rounded-md font-medium transition-all text-slate-500 hover:text-slate-700 hover:bg-slate-100";
        });
        
        let data, text, title;
        if (profile === 'standard') {
            data = [50, 20, 30];
            title = "Perfil Est√°ndar";
            text = "Equilibrio recomendado para la poblaci√≥n general.";
        } else if (profile === 'athlete') {
            data = [55, 25, 20];
            title = "Perfil Atleta";
            text = "Optimizado para rendimiento y recuperaci√≥n muscular.";
        } else if (profile === 'keto') {
            data = [10, 30, 60];
            title = "Perfil Low Carb/Keto";
            text = "Uso de grasas como fuente principal de energ√≠a.";
        }
        
        this.charts.dist.data.datasets[0].data = data;
        this.charts.dist.options.plugins.title.text = title;
        this.charts.dist.update();
        document.getElementById('dist-text').innerText = text;
    },
    
    calculateTDEE: function() {
        const gender = document.getElementById('calc-gender').value;
        const age = parseFloat(document.getElementById('calc-age').value) || 0;
        const weight = parseFloat(document.getElementById('calc-weight').value) || 0;
        const height = parseFloat(document.getElementById('calc-height').value) || 0;
        const activity = parseFloat(document.getElementById('calc-activity').value) || 1.2;
        
        if (!age || !weight || !height) return;
        
        let bmr = (10 * weight) + (6.25 * height) - (5 * age);
        bmr += (gender === 'male') ? 5 : -161;
        const tdee = Math.round(bmr * activity);
        
        this.state.tdee = tdee;
        document.getElementById('result-tdee').innerText = tdee;
        document.getElementById('result-cut').innerHTML = `${Math.round(tdee * 0.8)} <span class="text-sm text-slate-500">kcal</span>`;
        document.getElementById('result-bulk').innerHTML = `${Math.round(tdee * 1.1)} <span class="text-sm text-slate-500">kcal</span>`;
    },
    
    callGemini: async function(prompt, systemInstruction = "Eres un experto nutricionista.") {
        if (!apiKey || apiKey === "TU_API_KEY_AQUI") {
            return "‚ö†Ô∏è Error: API Key no configurada. Por favor, reemplaza 'TU_API_KEY_AQUI' con tu API Key real de Google Gemini.";
        }
        
        const maxRetries = 3;
        let attempt = 0;
        
        while (attempt < maxRetries) {
            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            systemInstruction: { parts: [{ text: systemInstruction }] }
                        })
                    }
                );
                
                const data = await response.json();
                if (data.candidates && data.candidates[0].content) {
                    return data.candidates[0].content.parts[0].text;
                }
                throw new Error("Respuesta inv√°lida");
            } catch {
                attempt++;
                await new Promise(r => setTimeout(r, 1000 * attempt));
                if (attempt === maxRetries) {
                    return "Error de conexi√≥n con la IA. Verifica tu API Key e intenta de nuevo.";
                }
            }
        }
    },
    
    addMessage: function(role, text) {
        const container = document.getElementById('chat-container');
        const isUser = role === 'user';
        
        const wrapper = document.createElement('div');
        wrapper.className = `flex gap-4 ${isUser ? 'justify-end' : ''}`;
        
        const avatar = isUser ? '' : '<div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center">ü§ñ</div>';
        const bubble = document.createElement('div');
        bubble.className = isUser
            ? 'bg-indigo-600 text-white p-4 rounded-2xl rounded-tr-none'
            : 'bg-white p-4 rounded-2xl rounded-tl-none border';
        bubble.innerHTML = text.replace(/\n/g, '<br>');
        
        wrapper.innerHTML = isUser ? bubble.outerHTML : avatar + bubble.outerHTML;
        container.appendChild(wrapper);
        container.scrollTop = container.scrollHeight;
    },
    
    analyzeFood: async function() {
        const input = document.getElementById('ai-food-input').value;
        if (!input) return;
        
        const btn = document.getElementById('btn-analyze');
        btn.disabled = true;
        btn.innerHTML = '<span class="loader"></span>';
        
        this.addMessage('user', `Analiza esto: ${input}`);
        this.addMessage('ai', 'Analizando composici√≥n nutricional...');
        
        const prompt = `Act√∫a como nutricionista. Analiza: "${input}". 
        1. Calor√≠as estimadas. 
        2. Macros aproximados (prote√≠nas, carbohidratos, grasas). 
        3. Puntos positivos y negativos. 
        4. Sugerencias para mejorar. 
        5. Veredicto final (¬øEs una comida saludable?).`;
        
        const response = await this.callGemini(prompt);
        this.addMessage('ai', response);
        
        btn.disabled = false;
        btn.innerHTML = '<span>‚ú®</span> Analizar Nutrientes';
    },
    
    generatePlan: async function() {
        const goal = document.getElementById('ai-plan-goal').value;
        const cal = document.getElementById('ai-plan-cal').value;
        
        const btn = document.getElementById('btn-plan');
        btn.disabled = true;
        btn.innerHTML = '<span class="loader"></span>';
        
        const prompt = `Crea un men√∫ diario detallado para el objetivo: ${goal}. 
        ${cal ? `Calor√≠as objetivo: ${cal}.` : ''}
        Incluye:
        1. Desayuno
        2. Almuerzo
        3. Cena
        4. 2 meriendas/snacks
        5. Total cal√≥rico estimado
        6. Distribuci√≥n de macronutrientes
        7. Consejos para preparaci√≥n`;
        
        this.addMessage('user', `Genera un plan para ${goal}`);
        this.addMessage('ai', 'Dise√±ando tu men√∫ personalizado...');
        
        const response = await this.callGemini(prompt);
        this.addMessage('ai', response);
        
        btn.disabled = false;
        btn.innerHTML = '<span>‚ú®</span> Generar Men√∫';
    },
    
    sendChat: async function() {
        const input = document.getElementById('chat-input');
        const text = input.value;
        if (!text) return;
        
        input.value = '';
        this.addMessage('user', text);
        
        const container = document.getElementById('chat-container');
        const thinking = document.createElement('div');
        thinking.id = 'thinking-bubble';
        thinking.className = 'flex gap-4';
        thinking.innerHTML = '<div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center">ü§ñ</div><div class="bg-white p-4 rounded-2xl border"><div class="loader"></div></div>';
        container.appendChild(thinking);
        container.scrollTop = container.scrollHeight;
        
        const response = await this.callGemini(text, "Eres un tutor de nutrici√≥n certificado. Responde con base cient√≠fica, s√© claro y conciso.");
        
        thinking.remove();
        this.addMessage('ai', response);
    },
    
    clearChat: function() {
        document.getElementById('chat-container').innerHTML = '';
        this.addMessage('ai', 'Chat reiniciado. ¬øEn qu√© puedo ayudarte hoy?');
    }
};

window.onload = () => app.init();
</script>
</body>
</html>